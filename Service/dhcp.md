# DHCP
[TOC]

## CentOS7
### 安装
```sh
sudo yum install -y dhcp
```

为本机设置静态IP
/etc/sysconfig/network-scripts/ifcfg-enp0s31f6
```
# Generated by dracut initrd
NAME="enp0s31f6"
DEVICE="enp0s31f6"
ONBOOT=yes
NETBOOT=yes
UUID="9133cbd4-e29f-4548-8d42-d967a9e87e6a"
IPV6INIT=yes
BOOTPROTO=static
TYPE=Ethernet

IPADDR=192.168.1.100
PREFIX=23
GATEWAY=192.168.1.1
DNS1=10.248.2.5
```

重启网络
```
sudo systemctl restart network.service
```

### 修改配置文件
/etc/dhcp/dhcpd.conf
```
option domain-name "myDHCP"                 # dhcp的主机名
option domain-name-servers 114.114.114.114; # DNS服务器

subnet 192.168.1.0 netmask 255.255.255.0 {
    range 192.168.1.101 192.168.1.254;
    option routers 192.168.1.1; 
    default-lease-time 600;
    max-lease-time 7200;
}

host Client_C {  #有一个主机，叫Client_C
    hardware ethernet 08:00:27:5e:04:27; # MAC地址是08:...:27的网卡
    fixed-address 192.168.1.123;         # 分配给它192.168.1.123的IP
}
```

`range 192.168.1.101 192.168.1.254`: 分配给客户机的IP从192.168.100.100开始到192.168.100.254
`option routers 192.168.1.1`: 设置网关
`default-lease-time 600`:  默认租约时间
`max-lease-time 7200`:  最大租约时间


### 开机启动
```sh
sudo systemctl enable dhcpd.service
sudo systemctl start dhcpd.service
```

## Ubuntu 14.04

为本机设置静态IP
/etc/network/interfaces
```
# The loopback network interface
auto lo
iface lo inet loopback
# The primary network interface
auto eth0
iface eth0 inet static
address 192.168.1.100
netmask 255.255.255.0
gateway 192.168.1.1
dns-nameservers 10.248.2.5
```

重启网络
```bash
sudo /etc/init.d/networking restart
```

### 安装
```bash
sudo apt-get install -y isc-dhcp-Server
```

### 修改配置文件
修改 /etc/default/dhcp-server
```
INTERFACES="eth0"
```

> `INTERFACES="eth0"` 如果有多块网卡 指定从 `eth0` 获取

修改 /etc/dhcp/dhcpd.conf
```
default-lease-time 600;
max-lease-time 7200;
subnet 192.168.1.1 netmask 255.255.255.0 {
range 192.168.1.101 192.168.1.254;
option subnet-mask 255.255.255.0;
option routers 192.168.1.100;
option broadcast-address 192.168.1.255;
filename "pxelinux.0";
next-Server 192.168.1.100;
}
```

> `filename "pxelinux.0";` 和 `next-Server 192.168.1.100;` 会去读取下一个server的 `pxelinux.0` 程序

启动 DHCP service.
```bash
sudo /etc/init.d/isc-dhcp-server start
```





